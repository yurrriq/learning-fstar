{ stdenv, coreutils, ocaml
, cppo, findlib, ocamlbuild, ppx_deriving, ppx_tools
}:

stdenv.mkDerivation rec {
  name = "visitors-${version}";
  version = "20180306";
  src = builtins.fetchTarball {
    url = "https://gitlab.inria.fr/fpottier/visitors/-/archive/${version}/visitors-${version}.tar.gz";
    sha256 = "1ym79yjz67fvwx6qlz70v7d74b6hy7mxrbwbgrp986c6n96qs3x9";
  };

  preBuild = ''
    substituteInPlace GNUmakefile \
        --replace /bin/date ${coreutils}/bin/date
  '';
  createFindlibDestdir = true;
  buildInputs = [
    ocaml
    cppo findlib ocamlbuild ppx_deriving ppx_tools
  ];
}
